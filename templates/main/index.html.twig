{% extends 'base.html.twig' %}

{% block body %}
	<main class="container">
		<section class="row">
			<div class="col-12">
				<h1>Mercadona</h1>
				<p>Bienvenue sur le site vitrine de notre boutique.<br>
                Vous pouvez choisir de trier les produits par catégories mais aussi de voir le catalogue entier.</p>
			</div>
            <h2>Trier par catégories</h2>
            <p>Sélectionner la catégorie de produits qui vous intéressent</p>
			{% for category in categories %}
				{% if category.parent == null %}
					<div class="col-12">
						<h2>{{ category.name }}</h2>
					</div>
				{% else %}
					<div class="col-4">
						<div class="card h-100">
							<div class="card-body">
								<h3 class="card-title">{{ category.name }}</h3>
								<a href="{{ path('categories_list', {slug: category.slug}) }}" class="btn btn-primary">Voir les produits</a>
							</div>
						</div>
					</div>
				{% endif %}
			{% endfor %}
		</section>

		<section class="row allProducts">
			<h2>Tous les produits</h2>
            <p>Retrouvez la totalité de nos produits</p>
			{% for product in products %}
				<div class="col-4 oneProduct">
					<div class="card h-100">
						<div class="card-body">
							<h3 class="card-title">{{ product.name }}</h3>
							<p class="card-text">{{ product.description }}</p>
							{% set promotion = null %}
							{% for promo in promotions %}
								{% if promo.products.id == product.id and promo.dateDeb|date("m/d/Y") <= 'now'|date("m/d/Y") and promo.dateFin|date("m/d/Y") >= 'now'|date("m/d/Y") %}
									{% set promotion = promo %}
								{% endif %}
							{% endfor %}
							{% if promotion is not null %}
								<p class="card-text"><strike>Prix :
									{{ product.price|number_format(2) }} €</strike><br>
                                    {% set discountedPrice = product.price - (product.price * promotion.pourcentage / 100) %}
									<p style="color:red;"><b>Prix promotionnel: {{ discountedPrice|number_format(2) }} €</b></p>
							{% else %}
								<p class="card-text">Prix :
									{{ product.price|number_format(2) }} €</p>
							{% endif %}
						</div>
					</div>
				</div>
			{% endfor %}
		</section>
	</main>
{% endblock %}
